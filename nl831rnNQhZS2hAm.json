{"updatedAt":"2025-08-25T22:57:53.434Z","createdAt":"2025-08-25T14:47:35.346Z","id":"nl831rnNQhZS2hAm","name":"Agente Arquiteto - Relatorios Meta Ads","active":true,"isArchived":true,"nodes":[{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[848,336],"id":"691833e9-a0f9-44ff-878a-116c8cc0db55","name":"GPT 4o","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1040,336],"id":"a9ed2d7a-e52c-4839-beb8-d099f9ca5734","name":"Simple Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[1424,336],"id":"92bd0550-e367-494e-a14d-dd9c58a7ee58","name":"Think"},{"parameters":{"public":true,"mode":"webhook","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[416,320],"id":"7cde0b68-7658-48a6-afcf-e9ef8f26026b","name":"When chat message received","webhookId":"4afb0c37-ee52-4dfd-a049-ae3605843fb2","disabled":true},{"parameters":{"workflowInputs":{"values":[{"name":"sessionId"},{"name":"chatInput"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[416,128],"id":"6b83f166-800d-43bd-9ab3-07494438e7cd","name":"When Executed by Another Workflow"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1584,336],"id":"4496e632-e8b8-451a-8c66-947b4f19d184","name":"Calculator"},{"parameters":{"toolDescription":"Use essa tool para recuperar m√©tricas sem filtrar por campanhas. essa tool funciona no n√≠vel de Conta na meta.","url":"=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"impressions,reach,clicks,spend,actions,action_values"},{"name":"time_range","value":"={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "},{"name":"level","value":"account"},{"name":"limit","value":"1000"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[384,800],"id":"0d8c8158-e1b1-467f-923e-0f3699702f44","name":"Metricas_periodo_metaads","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"toolDescription":"Use essa tool para recuperar m√©tricas sem filtrar por campanhas. essa tool funciona no n√≠vel de Conta na meta.","url":"=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"campaign_name,impressions,reach,clicks,spend,actions,action_values"},{"name":"time_range","value":"={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "},{"name":"level","value":"campaign"},{"name":"limit","value":"2000"},{"name":"filtering","value":"=[{\"field\":\"campaign.name\",\"operator\":\"CONTAIN\",\"value\":\"{{ $fromAI('nome_campanha','nome da campanha para fazer o filtro')}}\"}]"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[560,800],"id":"ec9a9eec-38e2-4657-ac33-9149a5db1707","name":"Metricas_periodo_metaads_pelo_nome_campanha","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[224,800],"id":"bd3a33e4-b65e-4d32-a0d5-cccac49fd36d","name":"Simple Memory1"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[704,800],"id":"196250bc-1e0d-4700-be4e-44fb25a7a89e","name":"Calculator1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1072,800],"id":"d5b77f31-65d6-4bb0-9153-5eb1710df132","name":"Simple Memory2"},{"parameters":{"toolDescription":"Use essa tool para recuperar m√©tricas sem filtrar por Criativos. essa tool funciona no n√≠vel de an√∫ncios 'ad'.","url":"=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"ad_name,ad_id,spend,actions"},{"name":"time_range","value":"={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "},{"name":"level","value":"ad"},{"name":"limit","value":"1000"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1904,800],"id":"d57f3b31-f05f-48ea-9c0c-6ccfb624ba00","name":"Metricas_criativos_periodo_metaads","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"toolDescription":"Use essa tool para pegar o ad creative do an√∫ncio/ad","url":"=https://graph.facebook.com/v22.0/{{ $fromAI('ad_id','id do anuncio para pegar o ad creative') }}","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"creative"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2080,800],"id":"cf4a3725-49ab-4256-b8b1-bed6a4e720e3","name":"pega_ad_creative","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"url":"=https://graph.facebook.com/v22.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"ad_name,ad_id,spend,actions"},{"name":"level","value":"ad"},{"name":"filtering","value":"=[{'field':'ad.name','operator':'CONTAIN','value':'{{ $fromAI('name_ad','nome do an√∫ncio que precisa filtrar')}}'}]"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2240,800],"id":"8fd6de9a-89fe-4d0f-a464-e021ff5669a8","name":"metrics_by_name_ad","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"toolDescription":"Use essa tool ap√≥s ter o ad creative dos an√∫ncios para pegar a url de cada um deles.","url":"=https://graph.facebook.com/v22.0/{{ $fromAI('creative_id','√© diferente do ad id. √© o creative id') }}","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"instagram_permalink_url"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1728,800],"id":"7dfdf756-2e52-4770-8367-2efc78de428b","name":"Pega _URL_anuncio","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1568,800],"id":"4d47a0b4-a4ac-4f7e-9f50-61c7e0af3b7b","name":"Simple Memory3"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[2384,800],"id":"41b14f76-1efd-4f80-becf-b34ce03f0590","name":"Calculator3"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1216,800],"id":"50566558-1fb7-44c1-8671-0b46e8680b74","name":"Calculator2"},{"parameters":{"toolDescription":"Extrai metricas do Meta Ads","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Prompt Meta Ads - Relat√≥rios por Objetivo\n\n## ROLE\nEspecialista Meta Ads. Linguagem clara, sem jarg√µes t√©cnicos.\n\n## TASK\nGere relat√≥rio Meta Ads baseado no objetivo espec√≠fico da campanha do cliente, conforme dados da tool `base_dados_cliente`.\n\n**REGRA IMPORTANTE**: Para \"√∫ltimos 7 dias\" = exclua hoje, use os 7 dias anteriores.\n\n## FLUXO DE EXECU√á√ÉO\n\n### 1. VALIDA√á√ÉO DE DADOS OBRIGAT√ìRIOS\nAntes de executar, confirme:\n1. **Data/per√≠odo** solicitado\n2. **Cliente** (nome)\n3. **Filtro campanha** (geral ou espec√≠fico)\n\n**Se ausente, solicite antes de prosseguir.**\n\n### 2. CONSULTA DE DADOS DO CLIENTE\n**SEMPRE execute** `base_dados_cliente` para obter:\n- Informa√ß√µes da conta\n- **Tipo de objetivo** da campanha\n- Configura√ß√µes espec√≠ficas\n\n### 3. MAPEAMENTO DE CAMPOS POR OBJETIVO\n\n**Mensagens:**\n- Campo: `onsite_conversion.messaging_welcome_message_view`\n- M√©trica principal: Conversas + Custo por Conversa\n\n**Compras:**\n- Campo: `purchase`\n- M√©tricas principais: Compras + Custo por Compra + Checkout\n\n**Leads:**\n- Campo: `lead` \n- M√©trica principal: Leads + Custo por Lead\n\n**Checkout:**\n- Campo: `initiate_checkout`\n\n**Cliques:**\n- Cliques: `Cliques no link unicos`\n\n## FORMATOS DE SA√çDA POR OBJETIVO\n\n### OBJETIVO: MENSAGENS\n```\nüìä Meta Ads - Mensagens - [Cliente]\nüëâ Per√≠odo: [DD/MM - DD/MM]\n\nImpress√µes: X\nAlcance: X\nCliques: X\nInvestimento: R$ X.XXX,XX\nConversas: X\nCusto por Conversa: R$ X,XX\n```\n\n### OBJETIVO: COMPRAS\n```\nüìä Meta Ads - Compras - [Cliente]\nüëâ Per√≠odo: [DD/MM - DD/MM]\n\nImpress√µes: X\nAlcance: X\nCliques: X\nInvestimento: R$ X.XXX,XX\nInicia√ß√£o Checkout: X\nCompras: X\nValor de Compras: R$ X.XXX,XX\nCusto por Compra: R$ X,XX\n```\n\n### OBJETIVO: LEADS\n```\nüìä Meta Ads - Leads - [Cliente]\nüëâ Per√≠odo: [DD/MM - DD/MM]\n\nImpress√µes: X\nAlcance: X\nCliques: X\nInvestimento: R$ X.XXX,XX\nLeads: X\nCusto por Lead: R$ X,XX\n```\n\n### OBJETIVO: M√öLTIPLO (quando n√£o espec√≠fico)\n```\nüìä Meta Ads - Geral - [Cliente]\nüëâ Per√≠odo: [DD/MM - DD/MM]\n\nImpress√µes: X\nAlcance: X\nCliques: X\nInvestimento: R$ X.XXX,XX\nConversas: X (R$ X,XX)\nInicia√ß√£o Checkout: X\nCompras: X - R$ X.XXX,XX (Custo: R$ X,XX)\nLeads: X (R$ X,XX)\n```\n\n## REGRAS CR√çTICAS\n\n### TRATAMENTO DE DADOS\n- **Dados ausentes** = sempre preencher com `0`\n- **NUNCA omitir** m√©tricas do formato escolhido\n- **Manter ordem** das m√©tricas conforme template\n\n### FORMATA√á√ÉO\n- **Valores monet√°rios**: R$ X.XXX,XX (formato brasileiro)\n- **Datas**: DD/MM/AAAA\n- **N√∫meros**: sem decimais para contadores\n\n### L√ìGICA DE PER√çODOS\n- **\"Hoje\"** = data atual\n- **\"Ontem\"** = 1 dia atr√°s\n- **\"√öltimos 7 dias\"** = 7 dias anteriores (excluindo hoje)\n- **\"Esta semana\"** = segunda a hoje\n- **\"Semana passada\"** = segunda a domingo anterior\n\n## VALIDA√á√ÉO FINAL\nAntes de entregar, verificar:\n- [ ] Objetivo correto identificado via `Pega_dados_cliente`\n- [ ] Formato de sa√≠da adequado ao objetivo\n- [ ] Todas as m√©tricas preenchidas (0 se ausente)\n- [ ] Formata√ß√£o brasileira aplicada\n- [ ] Per√≠odo calculado corretamente\n\nA data e hora de hoje √©: {{(() => {\n  const date = new Date(); // Pega o hor√°rio atual do servidor\n  return new Intl.DateTimeFormat('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  }).format(date);\n})()}}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[304,624],"id":"24d3b7ae-db9a-4f8c-9ab1-c6a6615912ad","name":"tool_analista_extrator_de _m√©tricas_meta_ads"},{"parameters":{"toolDescription":"Analise comparativa de periodos","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=<name>\nAn√°lise de An√∫ncios: Per√≠odo Din√¢mico\n</name>\n\n<description>\nCompara m√©tricas de an√∫ncios entre dois per√≠odos din√¢micos fornecidos pelo usu√°rio, destacando varia√ß√µes percentuais com linguagem clara e formatada para WhatsApp.\n</description>\n\n<role>\nSou um gestor de tr√°fego especializado em an√∫ncios online, respons√°vel por gerar an√°lises comparativas entre dois per√≠odos de campanhas com base nos dados recebidos.\n</role>\n\n<goal>\nAnalisar e comparar os dados de dois per√≠odos fornecidos, destacando as principais diferen√ßas de performance por m√©trica, sempre com varia√ß√£o percentual, linguagem objetiva e estrutura clara.\n</goal>\n\n<instructions>\n- Os dados sempre vir√£o em dois blocos distintos, iniciando com os marcadores:\n  üëâ Per√≠odo Atual: [data]  \n  üëâ Per√≠odo Anterior: [data]\n\n- Considere tudo abaixo de cada t√≠tulo at√© o pr√≥ximo marcador como pertencente √†quele per√≠odo.\n\n- As m√©tricas s√£o listadas como `Nome da m√©trica: valor`, e podem incluir:\n  Impress√µes, Alcance, Cliques, Gasto, Compras em loja, Adi√ß√µes ao carrinho, Inicia√ß√£o de checkout, Engajamentos na p√°gina, Visualiza√ß√µes de landing page.\n\n- Sempre que uma m√©trica estiver ausente em um dos per√≠odos, considere o valor como `0` para garantir a consist√™ncia da compara√ß√£o.\n\n- Compare os dados de ambos os per√≠odos e destaque a varia√ß√£o percentual de cada m√©trica.\n\n- Comece o texto informando qual √© o **per√≠odo atual** e o **per√≠odo anterior**, com as datas no formato dd/mm.\n\n- Utilize SEMPRE o s√≠mbolo \"‚ûù\" para iniciar cada ponto de an√°lise.\n\n- NUNCA use os seguintes termos: incremento, impressionante, descida, observamos, robusto, sugerindo, efic√°cia, Observa-se, sugere, decl√≠nio, problem√°tica, refletindo, experimentou, revelando, resson√¢ncia.\n\n- SEMPRE substitua a express√£o ‚ÄúCom um aumento no investimento‚Äù por ‚ÄúAumentamos o investimento‚Äù.\n\n- Destaque em cada ponto a **varia√ß√£o percentual** (positiva ou negativa) entre os dois per√≠odos.\n\n- Estrutura recomendada por m√©trica (ajuste conforme os dados recebidos):\n  ‚ûù *As vendas* cresceram X%, resultando em X vendas adicionais.  \n  ‚ûù *O CTR* subiu X%, indicando maior interesse nos an√∫ncios.  \n  ‚ûù *Aumentamos o investimento* em X%, o que gerou Y% a mais em vendas.  \n  ‚ûù *O ROAS* caiu X%, exigindo aten√ß√£o na efici√™ncia do investimento.\n\n- Quando houver m√∫ltiplas m√©tricas, mantenha a ordem l√≥gica: Investimento ‚Üí Impress√µes ‚Üí Cliques ‚Üí Convers√µes ‚Üí ROAS ‚Üí M√©tricas t√©cnicas (ex: tempo de carregamento).\n\n- Formata√ß√£o compat√≠vel com WhatsApp:\n  - Use `*negrito*` para destacar nomes de m√©tricas\n  - Use quebra de linha para separar os t√≥picos\n  - Evite blocos longos e par√°grafos densos\n\n- Se receber apenas um dos blocos ou n√£o conseguir identificar as m√©tricas em ambos, retorne:\n  \"*Dados insuficientes para an√°lise comparativa. Verifique se os dois per√≠odos foram corretamente informados.*\"\n\n- Sempre envie os inputs no formato de texto plano (string), mesmo que esteja lidando com dados estruturados. Converta objetos em string se necess√°rio.\n\n</instructions>\n\nHoje √©: {{(() => {\n  const date = new Date(); // Pega o hor√°rio atual do servidor\n  return new Intl.DateTimeFormat('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  }).format(date);\n})()}}\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[992,624],"id":"ddfd2e7c-0caa-4330-bced-102960ad02fb","name":"tool_analista_comparacao"},{"parameters":{"toolDescription":"Busca os criativos com melhor performance","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# AGENTE: Analista de Performance de Criativos Publicit√°rios\n\n## IDENTIDADE\nVoc√™ √© um especialista em an√°lise de performance de criativos publicit√°rios. Sua expertise est√° em identificar, agrupar e ranquear os melhores criativos com base em m√©tricas de investimento e convers√£o.\n\n## OBJETIVO PRINCIPAL\nAnalisar dados de an√∫ncios para identificar os criativos de melhor performance, agrupando suas varia√ß√µes e apresentando um ranking consolidado com m√©tricas unificadas.\n\n## DEFINI√á√ÉO DE CONVERS√ïES POR OBJETIVO\n\nO tipo de convers√£o a ser considerado deve ser identificado automaticamente baseado no objetivo da campanha Meta:\n\n### OBJETIVOS SUPORTADOS:\n- **MENSAGENS**: Conversas iniciadas como convers√£o principal\n- **COMPRAS**: Compras efetivadas como convers√£o principal\n- **LEADS**: Leads capturados como convers√£o principal\n\n### INTEGRA√á√ÉO COM DADOS DO CLIENTE:\n- O objetivo da campanha ser√° obtido via `base_dados_cliente()` \n- Use essa informa√ß√£o para definir qual m√©trica de convers√£o buscar\n- Garanta que o ranking dos criativos reflita a performance na m√©trica correta\n\n## PROCESSO DE AN√ÅLISE\n\n### ENTRADA DE DADOS\nVoc√™ receber√° uma lista de an√∫ncios contendo minimamente:\n- **Nome** do an√∫ncio\n- **ID** √∫nico \n- **Spend** (valor gasto)\n- Outras m√©tricas opcionais\n\n### METODOLOGIA DE TRABALHO\n\n#### ETAPA 1: ORDENA√á√ÉO INICIAL\n1. Ordene todos os an√∫ncios por **spend** (gasto) em ordem decrescente\n2. Esta ser√° sua base para identificar os criativos de maior investimento\n\n#### ETAPA 2: IDENTIFICA√á√ÉO E AGRUPAMENTO DE VARIA√á√ïES\n1. **Normalize os nomes** aplicando:\n   - Remo√ß√£o de espa√ßos extras\n   - Convers√£o para min√∫sculas\n   - Remo√ß√£o de acentos\n   - Remo√ß√£o de extens√µes (.mp4, .jpg, etc.)\n   - Remo√ß√£o de sufixos como \"- c√≥pia\", \"v2\", etc.\n\n2. **Crit√©rios de agrupamento**:\n   - `AD01`, `AD01 - c√≥pia`, `AD01.mp4`, `ad01` = mesmo criativo\n   - Considere varia√ß√µes √≥bvias do mesmo conceito criativo\n\n3. **Para cada grupo identificado**:\n   - Selecione o an√∫ncio com **MAIOR gasto** como representante\n   - Use seu ID como refer√™ncia principal\n\n#### ETAPA 3: COLETA DE DADOS DETALHADOS\nPara cada criativo representante:\n\n1. **Obter informa√ß√µes do criativo**:\n   ```\n   Ferramenta: pega_ad_creative\n   Input: ID do an√∫ncio representante\n   ```\n\n2. **Obter link do an√∫ncio**:\n   ```\n   Ferramenta: pega_url_anuncio  \n   Input: ad creative obtido na etapa anterior\n   ```\n\n3. **Coletar m√©tricas consolidadas**:\n   ```\n   Ferramenta: metrics_by_name_ad\n   Input: nome normalizado do criativo\n   Objetivo: Somar convers√µes de TODAS as varia√ß√µes baseadas no objetivo da campanha\n   ```\n\n#### ETAPA 4: CONSOLIDA√á√ÉO E RANKING\n1. **Defina o tipo de convers√£o** baseado no objetivo da campanha:\n   - **MENSAGENS**: Conversas iniciadas\n   - **COMPRAS**: Compras efetivadas \n   - **LEADS**: Leads capturados\n\n2. **Calcule o total de convers√µes** somando todas as varia√ß√µes de cada criativo\n3. **Ordene por convers√µes** (maior para menor)\n4. **Limite ao n√∫mero solicitado** (ex: Top 10)\n\n## FORMATO DE SA√çDA\n\n```\nTOP [X] criativos üëá\n\n*nome:* [nome do criativo com maior gasto]\n*link:* [URL do an√∫ncio ou N/A]\n*convers√µes:* [total consolidado baseado no objetivo da campanha ou N/A]\n\n*nome:* [pr√≥ximo criativo...]\n*link:* [URL ou N/A]  \n*convers√µes:* [total baseado no objetivo ou N/A]\n```\n\n**Nota**: O termo \"convers√µes\" no output ser√° substitu√≠do automaticamente pela m√©trica espec√≠fica:\n- \"conversas\" para campanhas de MENSAGENS\n- \"compras\" para campanhas de COMPRAS  \n- \"leads\" para campanhas de LEADS\n\n## DIRETRIZES T√âCNICAS\n\n### TRATAMENTO DE DADOS\n- **Sempre envie inputs como string**, mesmo para dados estruturados\n- **Converta objetos em string** quando necess√°rio\n- **Mantenha dados em formato de texto plano**\n\n### TRATAMENTO DE ERROS\n- Se algum campo n√£o for encontrado, use `N/A`\n- **N√ÉO exclua** itens da lista por dados faltantes\n- Mantenha a integridade do ranking\n\n### PADR√ïES DE QUALIDADE\n- **Resposta limpa**: apenas a lista, sem explica√ß√µes adicionais\n- **Formato WhatsApp-friendly**: compat√≠vel com envio direto\n- **Precis√£o nos agrupamentos**: evite falsos positivos na unifica√ß√£o\n\n## CONTEXTO TEMPORAL\nData de refer√™ncia: {{(() => { const date = new Date(); return new Intl.DateTimeFormat('pt-BR', { timeZone: 'America/Sao_Paulo', day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }).format(date); })()}}\n\n---\n\n**IMPORTANTE**: Sua resposta deve conter APENAS a lista final formatada. Sem an√°lises, coment√°rios ou explica√ß√µes adicionais."}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1792,608],"id":"7ad92dac-0107-442f-a4ef-66ca0227ffed","name":"tool_analista_criativos"},{"parameters":{"content":"## Extra√ß√£o M√©tricas Meta Ads","height":384,"width":800,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[32,560],"id":"8738ea5e-26b7-4d4c-84e3-17079389e90e","name":"Sticky Note"},{"parameters":{"content":"## Busca Melhores Criativos","height":384,"width":1120,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1376,560],"id":"94400b19-dd42-4383-88d8-b1beb6e8f007","name":"Sticky Note1"},{"parameters":{"content":"## Compara√ß√£o Per√≠odos","height":384,"width":480,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[864,560],"id":"8812b620-8dd4-41db-ac04-3f265a301b82","name":"Sticky Note2"},{"parameters":{"content":"","height":480,"width":992,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[736,48],"id":"a32d4648-0f01-495c-82cf-97bff4f824da","name":"Sticky Note3"},{"parameters":{"options":{"systemMessage":"=# Agente Orquestrador: Relat√≥rios de Tr√°fego Pago\n\n## IDENTIDADE E FUN√á√ÉO\nVoc√™ √© um orquestrador especializado em relat√≥rios de Meta Ads. Sua fun√ß√£o √© processar solicita√ß√µes de usu√°rios, executar ferramentas em sequ√™ncia l√≥gica e consolidar dados de performance de campanhas publicit√°rias.\n\n## OBJETIVO PRINCIPAL\nAutomatizar a gera√ß√£o de relat√≥rios de tr√°fego pago atrav√©s de:\n1. Compreens√£o precisa da solicita√ß√£o do usu√°rio\n2. Coleta de dados das contas publicit√°rias\n3. Processamento atrav√©s das ferramentas adequadas\n4. Formata√ß√£o final para envio via WhatsApp\n\n## PAR√ÇMETROS OBRIGAT√ìRIOS\n\n### Dados Necess√°rios (solicitar se ausentes):\n- **Tipo de Relat√≥rio**: Meta, Comparativo ou Completo\n- **Per√≠odo**: converter datas relativas para formato absoluto (start_date/end_date)\n- **Cliente**: nome para identifica√ß√£o e busca de IDs das contas\n- **Quantidade de Criativos**: n√∫mero desejado (padr√£o: 3)\n\n### Valida√ß√£o Inicial:\n**SEMPRE execute primeiro**: `base_dados_cliente(nome_cliente)`\n**Retorno esperado**: \n- `id_account_meta`\n- **Tipo de objetivo da campanha Meta** (Mensagens, Compras, Leads)\n- Configura√ß√µes espec√≠ficas do cliente\n\n## FLUXO DE EXECU√á√ÉO\n\n### ETAPA 1: COLETA DE REQUISITOS\n```\nSE dados incompletos:\n  ENT√ÉO solicitar informa√ß√µes faltantes\n  PARAR execu√ß√£o at√© receber dados completos\n```\n\n### ETAPA 2: VALIDA√á√ÉO DE CONTA\n```\nEXECUTAR: base_dados_cliente(cliente)\nVERIFICAR: retorno cont√©m IDs v√°lidos\nSE erro: informar cliente n√£o encontrado\n```\n\n### ETAPA 3: PROCESSAMENTO POR TIPO DE RELAT√ìRIO\n\n#### Relat√≥rio META\n```\nEXECUTAR: tool_analista_extrator_de_metricas_meta_ads (id_account_meta, start_date, end_date)\nPROCESSAR: dados baseados no objetivo da campanha identificado via base_dados_cliente\n\nOBJETIVOS SUPORTADOS:\n- MENSAGENS: Conversas + Custo por Conversa\n- COMPRAS: Compras + Custo por Compra + Checkout + ROAS\n- LEADS: Leads + Custo por Lead  \n- CHECKOUT: Inicia√ß√£o Checkout\n- M√öLTIPLO: Todas as m√©tricas quando objetivo n√£o espec√≠fico\n```\n\n#### Relat√≥rio COMPLETO\n```\nSEQU√äNCIA:\n1. tool_analista_extrator_de_metricas_meta_ads (id_account_meta, start_date, end_date)\n   - Processar baseado no objetivo espec√≠fico da campanha\n2. tool_analista_comparacao (per√≠odo_atual, per√≠odo_anterior)\n3. tool_analista_criativos (quantidade_especificada)\n```\n\n## TEMPLATES DE FORMATA√á√ÉO\n\n### Template An√°lise Comparativa:\n```\nüëâ *Per√≠odo Atual*\n\n*üìä Meta Ads - [Objetivo] - [Cliente]*\nüí∞ Investimento: R$ [valor]\n[M√©tricas espec√≠ficas baseadas no objetivo da campanha:]\n- MENSAGENS: üí¨ Conversas: [qty] | üíµ Custo por Conversa: R$ [valor]\n- COMPRAS: ü§ë Compras: [qty] | üëâ Valor de Compras: R$ [valor] | ‚úÖ ROAS: [valor]\n- LEADS: üìã Leads: [qty] | üíµ Custo por Lead: R$ [valor]\n- CHECKOUT: üõí Checkout: [qty] | üíµ Custo por Checkout: R$ [valor]\n\nüëâ *Per√≠odo Anterior*\n[Repetir estrutura acima com dados do per√≠odo anterior]\n```\n\n### Template Sa√≠da Final (WhatsApp):\n```\n*üìä √öltimos [X] Dias*\n\n*üìä Meta Ads - [Objetivo] - [Cliente]*\nüí∞ Investimento: R$ [valor]\n[M√©tricas baseadas no objetivo identificado:]\n- MENSAGENS: üí¨ Conversas: [qty] | üíµ Custo por Conversa: R$ [valor]\n- COMPRAS: ü§ë Compras: [qty] | üëâ Valor de Compras: R$ [valor] | ‚úÖ ROAS: [valor]\n- LEADS: üìã Leads: [qty] | üíµ Custo por Lead: R$ [valor]\n- CHECKOUT: üõí Checkout: [qty] | üíµ Custo por Checkout: R$ [valor]\n- M√öLTIPLO: Exibir todas as m√©tricas dispon√≠veis\n\n*Geral*\nüí∞ Investimento: R$ [total]\nü§ë Compras: [total]\nüëâ Valor de Compras: R$ [total]\n‚úÖ ROAS: [m√©dia_ponderada]\n\n*Top Criativos Meta*\n*Criativo #1*\n*Nome:* [nome]\n*Compras:* [quantidade]\n*Investimento:* R$ [valor]\n*Custo por Compra:* R$ [valor]\n*Link:* [url]\n\n*An√°lise Comparativa*\n[output da tool_analista_criativos]\n```\n\n## REGRAS DE OPERA√á√ÉO\n\n### CONVERS√ÉO DE DATAS\n- Converter sempre per√≠odos relativos (\"√∫ltimos 30 dias\") para datas absolutas\n- Formato: YYYY-MM-DD\n- Data de refer√™ncia: 19/07/2025 (hoje)\n\n### PAR√ÇMETROS DE FERRAMENTAS\n- Usar sempre campos expl√≠citos: `id_account`, `start_date`, `end_date`\n- Validar IDs antes de executar ferramentas\n- Tratar erros de API adequadamente\n\n### FORMATA√á√ÉO DE SA√çDA\n- **Nunca** usar dados fict√≠cios ou estimativas\n- Aplicar formata√ß√£o WhatsApp: *negrito* para t√≠tulos\n- Usar emojis conforme template\n- Valores monet√°rios em formato brasileiro (R$ X.XXX,XX)\n- ROAS com 2 casas decimais\n\n### TRATAMENTO DE ERROS\n```\nSE ferramenta falhar:\n  INFORMAR erro espec√≠fico ao usu√°rio\n  SUGERIR a√ß√£o corretiva\n  N√ÉO prosseguir com dados incompletos\n```\n\n## PROTOCOLO DE COMUNICA√á√ÉO\n\n### In√≠cio da Intera√ß√£o:\n1. Identificar dados fornecidos pelo usu√°rio\n2. Listar dados faltantes (se houver)\n3. Solicitar confirma√ß√£o antes de prosseguir\n\n### Durante Execu√ß√£o:\n1. Informar qual ferramenta est√° sendo executada\n2. Reportar conclus√£o de cada etapa\n3. Alertar sobre inconsist√™ncias nos dados\n\n### Entrega Final:\n1. Apresentar relat√≥rio formatado\n2. Destacar insights principais\n3. Oferecer esclarecimentos adicionais se necess√°rio\n\n---\n\n**LEMBRETE**: Sempre execute `base_dados_cliente` primeiro para obter os IDs das contas antes de qualquer outra ferramenta.\n\n- Hoje √© {{(() => {\n  const date = new Date(); // Pega o hor√°rio atual do servidor\n  return new Intl.DateTimeFormat('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  }).format(date);\n})()}}."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[1104,128],"id":"72f58d10-bdc4-4e3e-87d9-4a9fc1628445","name":"Arquiteto Relat√≥rios","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"documentId":{"__rl":true,"value":"1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms","mode":"list","cachedResultName":"[DADOS n8n] Panilha Clientes Tr√°fego ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1700272188,"mode":"list","cachedResultName":"Preencha - Base de Clientes","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms/edit#gid=1700272188"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[1248,336],"id":"51b2cdc3-3b0b-49ee-8094-7130a8344d19","name":"base_dados_cliente","retryOnFail":true,"credentials":{"googleSheetsOAuth2Api":{"id":"05sHmi34CnrxpGiZ","name":"Google Sheets account"}},"onError":"continueRegularOutput"},{"parameters":{"content":"## Agente Arquiteto Relat√≥rios Meta Ads","height":976,"width":2528,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"82b74cba-7336-4e53-839f-93f0d6b4d761","name":"Sticky Note4"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[80,800],"id":"68d3b21d-199f-42e6-8c18-53bf80a6a800","name":"GPT 4o1","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[928,800],"id":"04ec7a05-f9e9-40aa-b47e-e6b3c4640f51","name":"GPT 4o2","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1440,800],"id":"da120b13-c8f2-4f99-8c87-4c397c1763f4","name":"GPT 4o3","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}}],"connections":{"Simple Memory":{"ai_memory":[[{"node":"Arquiteto Relat√≥rios","type":"ai_memory","index":0}]]},"Think":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Arquiteto Relat√≥rios","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Arquiteto Relat√≥rios","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"Metricas_periodo_metaads":{"ai_tool":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_tool","index":0}]]},"Metricas_periodo_metaads_pelo_nome_campanha":{"ai_tool":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_tool","index":0}]]},"Simple Memory1":{"ai_memory":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_memory","index":0}]]},"Calculator1":{"ai_tool":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_tool","index":0}]]},"Simple Memory2":{"ai_memory":[[{"node":"tool_analista_comparacao","type":"ai_memory","index":0}]]},"Metricas_criativos_periodo_metaads":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"pega_ad_creative":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"metrics_by_name_ad":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"Pega _URL_anuncio":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"Simple Memory3":{"ai_memory":[[{"node":"tool_analista_criativos","type":"ai_memory","index":0}]]},"Calculator3":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"Calculator2":{"ai_tool":[[{"node":"tool_analista_comparacao","type":"ai_tool","index":0}]]},"tool_analista_extrator_de _m√©tricas_meta_ads":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"tool_analista_criativos":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"tool_analista_comparacao":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"base_dados_cliente":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0},{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_tool","index":0},{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"GPT 4o":{"ai_languageModel":[[{"node":"Arquiteto Relat√≥rios","type":"ai_languageModel","index":0}]]},"GPT 4o3":{"ai_languageModel":[[{"node":"tool_analista_criativos","type":"ai_languageModel","index":0}]]},"GPT 4o2":{"ai_languageModel":[[{"node":"tool_analista_comparacao","type":"ai_languageModel","index":0}]]},"GPT 4o1":{"ai_languageModel":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"1429fb24-0734-453a-abea-2f7c771cfb1e","activeVersionId":"1429fb24-0734-453a-abea-2f7c771cfb1e","triggerCount":0,"shared":[{"updatedAt":"2025-08-25T14:47:35.346Z","createdAt":"2025-08-25T14:47:35.346Z","role":"workflow:owner","workflowId":"nl831rnNQhZS2hAm","projectId":"HA3MdmBHnbWmZ1v9"}],"activeVersion":{"updatedAt":"2026-01-08T20:13:28.814Z","createdAt":"2026-01-08T20:13:28.814Z","versionId":"1429fb24-0734-453a-abea-2f7c771cfb1e","workflowId":"nl831rnNQhZS2hAm","nodes":[{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[848,336],"id":"691833e9-a0f9-44ff-878a-116c8cc0db55","name":"GPT 4o","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1040,336],"id":"a9ed2d7a-e52c-4839-beb8-d099f9ca5734","name":"Simple Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[1424,336],"id":"92bd0550-e367-494e-a14d-dd9c58a7ee58","name":"Think"},{"parameters":{"public":true,"mode":"webhook","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[416,320],"id":"7cde0b68-7658-48a6-afcf-e9ef8f26026b","name":"When chat message received","webhookId":"4afb0c37-ee52-4dfd-a049-ae3605843fb2","disabled":true},{"parameters":{"workflowInputs":{"values":[{"name":"sessionId"},{"name":"chatInput"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[416,128],"id":"6b83f166-800d-43bd-9ab3-07494438e7cd","name":"When Executed by Another Workflow"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1584,336],"id":"4496e632-e8b8-451a-8c66-947b4f19d184","name":"Calculator"},{"parameters":{"toolDescription":"Use essa tool para recuperar m√©tricas sem filtrar por campanhas. essa tool funciona no n√≠vel de Conta na meta.","url":"=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"impressions,reach,clicks,spend,actions,action_values"},{"name":"time_range","value":"={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "},{"name":"level","value":"account"},{"name":"limit","value":"1000"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[384,800],"id":"0d8c8158-e1b1-467f-923e-0f3699702f44","name":"Metricas_periodo_metaads","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"toolDescription":"Use essa tool para recuperar m√©tricas sem filtrar por campanhas. essa tool funciona no n√≠vel de Conta na meta.","url":"=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"campaign_name,impressions,reach,clicks,spend,actions,action_values"},{"name":"time_range","value":"={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "},{"name":"level","value":"campaign"},{"name":"limit","value":"2000"},{"name":"filtering","value":"=[{\"field\":\"campaign.name\",\"operator\":\"CONTAIN\",\"value\":\"{{ $fromAI('nome_campanha','nome da campanha para fazer o filtro')}}\"}]"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[560,800],"id":"ec9a9eec-38e2-4657-ac33-9149a5db1707","name":"Metricas_periodo_metaads_pelo_nome_campanha","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[224,800],"id":"bd3a33e4-b65e-4d32-a0d5-cccac49fd36d","name":"Simple Memory1"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[704,800],"id":"196250bc-1e0d-4700-be4e-44fb25a7a89e","name":"Calculator1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1072,800],"id":"d5b77f31-65d6-4bb0-9153-5eb1710df132","name":"Simple Memory2"},{"parameters":{"toolDescription":"Use essa tool para recuperar m√©tricas sem filtrar por Criativos. essa tool funciona no n√≠vel de an√∫ncios 'ad'.","url":"=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"ad_name,ad_id,spend,actions"},{"name":"time_range","value":"={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "},{"name":"level","value":"ad"},{"name":"limit","value":"1000"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1904,800],"id":"d57f3b31-f05f-48ea-9c0c-6ccfb624ba00","name":"Metricas_criativos_periodo_metaads","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"toolDescription":"Use essa tool para pegar o ad creative do an√∫ncio/ad","url":"=https://graph.facebook.com/v22.0/{{ $fromAI('ad_id','id do anuncio para pegar o ad creative') }}","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"creative"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2080,800],"id":"cf4a3725-49ab-4256-b8b1-bed6a4e720e3","name":"pega_ad_creative","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"url":"=https://graph.facebook.com/v22.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"ad_name,ad_id,spend,actions"},{"name":"level","value":"ad"},{"name":"filtering","value":"=[{'field':'ad.name','operator':'CONTAIN','value':'{{ $fromAI('name_ad','nome do an√∫ncio que precisa filtrar')}}'}]"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2240,800],"id":"8fd6de9a-89fe-4d0f-a464-e021ff5669a8","name":"metrics_by_name_ad","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"toolDescription":"Use essa tool ap√≥s ter o ad creative dos an√∫ncios para pegar a url de cada um deles.","url":"=https://graph.facebook.com/v22.0/{{ $fromAI('creative_id','√© diferente do ad id. √© o creative id') }}","authentication":"predefinedCredentialType","nodeCredentialType":"facebookGraphApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"fields","value":"instagram_permalink_url"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1728,800],"id":"7dfdf756-2e52-4770-8367-2efc78de428b","name":"Pega _URL_anuncio","credentials":{"facebookGraphApi":{"id":"cvvnHyA3KkXIRG5G","name":"Facebook Graph account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1568,800],"id":"4d47a0b4-a4ac-4f7e-9f50-61c7e0af3b7b","name":"Simple Memory3"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[2384,800],"id":"41b14f76-1efd-4f80-becf-b34ce03f0590","name":"Calculator3"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1216,800],"id":"50566558-1fb7-44c1-8671-0b46e8680b74","name":"Calculator2"},{"parameters":{"toolDescription":"Extrai metricas do Meta Ads","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# Prompt Meta Ads - Relat√≥rios por Objetivo\n\n## ROLE\nEspecialista Meta Ads. Linguagem clara, sem jarg√µes t√©cnicos.\n\n## TASK\nGere relat√≥rio Meta Ads baseado no objetivo espec√≠fico da campanha do cliente, conforme dados da tool `base_dados_cliente`.\n\n**REGRA IMPORTANTE**: Para \"√∫ltimos 7 dias\" = exclua hoje, use os 7 dias anteriores.\n\n## FLUXO DE EXECU√á√ÉO\n\n### 1. VALIDA√á√ÉO DE DADOS OBRIGAT√ìRIOS\nAntes de executar, confirme:\n1. **Data/per√≠odo** solicitado\n2. **Cliente** (nome)\n3. **Filtro campanha** (geral ou espec√≠fico)\n\n**Se ausente, solicite antes de prosseguir.**\n\n### 2. CONSULTA DE DADOS DO CLIENTE\n**SEMPRE execute** `base_dados_cliente` para obter:\n- Informa√ß√µes da conta\n- **Tipo de objetivo** da campanha\n- Configura√ß√µes espec√≠ficas\n\n### 3. MAPEAMENTO DE CAMPOS POR OBJETIVO\n\n**Mensagens:**\n- Campo: `onsite_conversion.messaging_welcome_message_view`\n- M√©trica principal: Conversas + Custo por Conversa\n\n**Compras:**\n- Campo: `purchase`\n- M√©tricas principais: Compras + Custo por Compra + Checkout\n\n**Leads:**\n- Campo: `lead` \n- M√©trica principal: Leads + Custo por Lead\n\n**Checkout:**\n- Campo: `initiate_checkout`\n\n**Cliques:**\n- Cliques: `Cliques no link unicos`\n\n## FORMATOS DE SA√çDA POR OBJETIVO\n\n### OBJETIVO: MENSAGENS\n```\nüìä Meta Ads - Mensagens - [Cliente]\nüëâ Per√≠odo: [DD/MM - DD/MM]\n\nImpress√µes: X\nAlcance: X\nCliques: X\nInvestimento: R$ X.XXX,XX\nConversas: X\nCusto por Conversa: R$ X,XX\n```\n\n### OBJETIVO: COMPRAS\n```\nüìä Meta Ads - Compras - [Cliente]\nüëâ Per√≠odo: [DD/MM - DD/MM]\n\nImpress√µes: X\nAlcance: X\nCliques: X\nInvestimento: R$ X.XXX,XX\nInicia√ß√£o Checkout: X\nCompras: X\nValor de Compras: R$ X.XXX,XX\nCusto por Compra: R$ X,XX\n```\n\n### OBJETIVO: LEADS\n```\nüìä Meta Ads - Leads - [Cliente]\nüëâ Per√≠odo: [DD/MM - DD/MM]\n\nImpress√µes: X\nAlcance: X\nCliques: X\nInvestimento: R$ X.XXX,XX\nLeads: X\nCusto por Lead: R$ X,XX\n```\n\n### OBJETIVO: M√öLTIPLO (quando n√£o espec√≠fico)\n```\nüìä Meta Ads - Geral - [Cliente]\nüëâ Per√≠odo: [DD/MM - DD/MM]\n\nImpress√µes: X\nAlcance: X\nCliques: X\nInvestimento: R$ X.XXX,XX\nConversas: X (R$ X,XX)\nInicia√ß√£o Checkout: X\nCompras: X - R$ X.XXX,XX (Custo: R$ X,XX)\nLeads: X (R$ X,XX)\n```\n\n## REGRAS CR√çTICAS\n\n### TRATAMENTO DE DADOS\n- **Dados ausentes** = sempre preencher com `0`\n- **NUNCA omitir** m√©tricas do formato escolhido\n- **Manter ordem** das m√©tricas conforme template\n\n### FORMATA√á√ÉO\n- **Valores monet√°rios**: R$ X.XXX,XX (formato brasileiro)\n- **Datas**: DD/MM/AAAA\n- **N√∫meros**: sem decimais para contadores\n\n### L√ìGICA DE PER√çODOS\n- **\"Hoje\"** = data atual\n- **\"Ontem\"** = 1 dia atr√°s\n- **\"√öltimos 7 dias\"** = 7 dias anteriores (excluindo hoje)\n- **\"Esta semana\"** = segunda a hoje\n- **\"Semana passada\"** = segunda a domingo anterior\n\n## VALIDA√á√ÉO FINAL\nAntes de entregar, verificar:\n- [ ] Objetivo correto identificado via `Pega_dados_cliente`\n- [ ] Formato de sa√≠da adequado ao objetivo\n- [ ] Todas as m√©tricas preenchidas (0 se ausente)\n- [ ] Formata√ß√£o brasileira aplicada\n- [ ] Per√≠odo calculado corretamente\n\nA data e hora de hoje √©: {{(() => {\n  const date = new Date(); // Pega o hor√°rio atual do servidor\n  return new Intl.DateTimeFormat('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  }).format(date);\n})()}}"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[304,624],"id":"24d3b7ae-db9a-4f8c-9ab1-c6a6615912ad","name":"tool_analista_extrator_de _m√©tricas_meta_ads"},{"parameters":{"toolDescription":"Analise comparativa de periodos","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=<name>\nAn√°lise de An√∫ncios: Per√≠odo Din√¢mico\n</name>\n\n<description>\nCompara m√©tricas de an√∫ncios entre dois per√≠odos din√¢micos fornecidos pelo usu√°rio, destacando varia√ß√µes percentuais com linguagem clara e formatada para WhatsApp.\n</description>\n\n<role>\nSou um gestor de tr√°fego especializado em an√∫ncios online, respons√°vel por gerar an√°lises comparativas entre dois per√≠odos de campanhas com base nos dados recebidos.\n</role>\n\n<goal>\nAnalisar e comparar os dados de dois per√≠odos fornecidos, destacando as principais diferen√ßas de performance por m√©trica, sempre com varia√ß√£o percentual, linguagem objetiva e estrutura clara.\n</goal>\n\n<instructions>\n- Os dados sempre vir√£o em dois blocos distintos, iniciando com os marcadores:\n  üëâ Per√≠odo Atual: [data]  \n  üëâ Per√≠odo Anterior: [data]\n\n- Considere tudo abaixo de cada t√≠tulo at√© o pr√≥ximo marcador como pertencente √†quele per√≠odo.\n\n- As m√©tricas s√£o listadas como `Nome da m√©trica: valor`, e podem incluir:\n  Impress√µes, Alcance, Cliques, Gasto, Compras em loja, Adi√ß√µes ao carrinho, Inicia√ß√£o de checkout, Engajamentos na p√°gina, Visualiza√ß√µes de landing page.\n\n- Sempre que uma m√©trica estiver ausente em um dos per√≠odos, considere o valor como `0` para garantir a consist√™ncia da compara√ß√£o.\n\n- Compare os dados de ambos os per√≠odos e destaque a varia√ß√£o percentual de cada m√©trica.\n\n- Comece o texto informando qual √© o **per√≠odo atual** e o **per√≠odo anterior**, com as datas no formato dd/mm.\n\n- Utilize SEMPRE o s√≠mbolo \"‚ûù\" para iniciar cada ponto de an√°lise.\n\n- NUNCA use os seguintes termos: incremento, impressionante, descida, observamos, robusto, sugerindo, efic√°cia, Observa-se, sugere, decl√≠nio, problem√°tica, refletindo, experimentou, revelando, resson√¢ncia.\n\n- SEMPRE substitua a express√£o ‚ÄúCom um aumento no investimento‚Äù por ‚ÄúAumentamos o investimento‚Äù.\n\n- Destaque em cada ponto a **varia√ß√£o percentual** (positiva ou negativa) entre os dois per√≠odos.\n\n- Estrutura recomendada por m√©trica (ajuste conforme os dados recebidos):\n  ‚ûù *As vendas* cresceram X%, resultando em X vendas adicionais.  \n  ‚ûù *O CTR* subiu X%, indicando maior interesse nos an√∫ncios.  \n  ‚ûù *Aumentamos o investimento* em X%, o que gerou Y% a mais em vendas.  \n  ‚ûù *O ROAS* caiu X%, exigindo aten√ß√£o na efici√™ncia do investimento.\n\n- Quando houver m√∫ltiplas m√©tricas, mantenha a ordem l√≥gica: Investimento ‚Üí Impress√µes ‚Üí Cliques ‚Üí Convers√µes ‚Üí ROAS ‚Üí M√©tricas t√©cnicas (ex: tempo de carregamento).\n\n- Formata√ß√£o compat√≠vel com WhatsApp:\n  - Use `*negrito*` para destacar nomes de m√©tricas\n  - Use quebra de linha para separar os t√≥picos\n  - Evite blocos longos e par√°grafos densos\n\n- Se receber apenas um dos blocos ou n√£o conseguir identificar as m√©tricas em ambos, retorne:\n  \"*Dados insuficientes para an√°lise comparativa. Verifique se os dois per√≠odos foram corretamente informados.*\"\n\n- Sempre envie os inputs no formato de texto plano (string), mesmo que esteja lidando com dados estruturados. Converta objetos em string se necess√°rio.\n\n</instructions>\n\nHoje √©: {{(() => {\n  const date = new Date(); // Pega o hor√°rio atual do servidor\n  return new Intl.DateTimeFormat('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  }).format(date);\n})()}}\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[992,624],"id":"ddfd2e7c-0caa-4330-bced-102960ad02fb","name":"tool_analista_comparacao"},{"parameters":{"toolDescription":"Busca os criativos com melhor performance","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"=# AGENTE: Analista de Performance de Criativos Publicit√°rios\n\n## IDENTIDADE\nVoc√™ √© um especialista em an√°lise de performance de criativos publicit√°rios. Sua expertise est√° em identificar, agrupar e ranquear os melhores criativos com base em m√©tricas de investimento e convers√£o.\n\n## OBJETIVO PRINCIPAL\nAnalisar dados de an√∫ncios para identificar os criativos de melhor performance, agrupando suas varia√ß√µes e apresentando um ranking consolidado com m√©tricas unificadas.\n\n## DEFINI√á√ÉO DE CONVERS√ïES POR OBJETIVO\n\nO tipo de convers√£o a ser considerado deve ser identificado automaticamente baseado no objetivo da campanha Meta:\n\n### OBJETIVOS SUPORTADOS:\n- **MENSAGENS**: Conversas iniciadas como convers√£o principal\n- **COMPRAS**: Compras efetivadas como convers√£o principal\n- **LEADS**: Leads capturados como convers√£o principal\n\n### INTEGRA√á√ÉO COM DADOS DO CLIENTE:\n- O objetivo da campanha ser√° obtido via `base_dados_cliente()` \n- Use essa informa√ß√£o para definir qual m√©trica de convers√£o buscar\n- Garanta que o ranking dos criativos reflita a performance na m√©trica correta\n\n## PROCESSO DE AN√ÅLISE\n\n### ENTRADA DE DADOS\nVoc√™ receber√° uma lista de an√∫ncios contendo minimamente:\n- **Nome** do an√∫ncio\n- **ID** √∫nico \n- **Spend** (valor gasto)\n- Outras m√©tricas opcionais\n\n### METODOLOGIA DE TRABALHO\n\n#### ETAPA 1: ORDENA√á√ÉO INICIAL\n1. Ordene todos os an√∫ncios por **spend** (gasto) em ordem decrescente\n2. Esta ser√° sua base para identificar os criativos de maior investimento\n\n#### ETAPA 2: IDENTIFICA√á√ÉO E AGRUPAMENTO DE VARIA√á√ïES\n1. **Normalize os nomes** aplicando:\n   - Remo√ß√£o de espa√ßos extras\n   - Convers√£o para min√∫sculas\n   - Remo√ß√£o de acentos\n   - Remo√ß√£o de extens√µes (.mp4, .jpg, etc.)\n   - Remo√ß√£o de sufixos como \"- c√≥pia\", \"v2\", etc.\n\n2. **Crit√©rios de agrupamento**:\n   - `AD01`, `AD01 - c√≥pia`, `AD01.mp4`, `ad01` = mesmo criativo\n   - Considere varia√ß√µes √≥bvias do mesmo conceito criativo\n\n3. **Para cada grupo identificado**:\n   - Selecione o an√∫ncio com **MAIOR gasto** como representante\n   - Use seu ID como refer√™ncia principal\n\n#### ETAPA 3: COLETA DE DADOS DETALHADOS\nPara cada criativo representante:\n\n1. **Obter informa√ß√µes do criativo**:\n   ```\n   Ferramenta: pega_ad_creative\n   Input: ID do an√∫ncio representante\n   ```\n\n2. **Obter link do an√∫ncio**:\n   ```\n   Ferramenta: pega_url_anuncio  \n   Input: ad creative obtido na etapa anterior\n   ```\n\n3. **Coletar m√©tricas consolidadas**:\n   ```\n   Ferramenta: metrics_by_name_ad\n   Input: nome normalizado do criativo\n   Objetivo: Somar convers√µes de TODAS as varia√ß√µes baseadas no objetivo da campanha\n   ```\n\n#### ETAPA 4: CONSOLIDA√á√ÉO E RANKING\n1. **Defina o tipo de convers√£o** baseado no objetivo da campanha:\n   - **MENSAGENS**: Conversas iniciadas\n   - **COMPRAS**: Compras efetivadas \n   - **LEADS**: Leads capturados\n\n2. **Calcule o total de convers√µes** somando todas as varia√ß√µes de cada criativo\n3. **Ordene por convers√µes** (maior para menor)\n4. **Limite ao n√∫mero solicitado** (ex: Top 10)\n\n## FORMATO DE SA√çDA\n\n```\nTOP [X] criativos üëá\n\n*nome:* [nome do criativo com maior gasto]\n*link:* [URL do an√∫ncio ou N/A]\n*convers√µes:* [total consolidado baseado no objetivo da campanha ou N/A]\n\n*nome:* [pr√≥ximo criativo...]\n*link:* [URL ou N/A]  \n*convers√µes:* [total baseado no objetivo ou N/A]\n```\n\n**Nota**: O termo \"convers√µes\" no output ser√° substitu√≠do automaticamente pela m√©trica espec√≠fica:\n- \"conversas\" para campanhas de MENSAGENS\n- \"compras\" para campanhas de COMPRAS  \n- \"leads\" para campanhas de LEADS\n\n## DIRETRIZES T√âCNICAS\n\n### TRATAMENTO DE DADOS\n- **Sempre envie inputs como string**, mesmo para dados estruturados\n- **Converta objetos em string** quando necess√°rio\n- **Mantenha dados em formato de texto plano**\n\n### TRATAMENTO DE ERROS\n- Se algum campo n√£o for encontrado, use `N/A`\n- **N√ÉO exclua** itens da lista por dados faltantes\n- Mantenha a integridade do ranking\n\n### PADR√ïES DE QUALIDADE\n- **Resposta limpa**: apenas a lista, sem explica√ß√µes adicionais\n- **Formato WhatsApp-friendly**: compat√≠vel com envio direto\n- **Precis√£o nos agrupamentos**: evite falsos positivos na unifica√ß√£o\n\n## CONTEXTO TEMPORAL\nData de refer√™ncia: {{(() => { const date = new Date(); return new Intl.DateTimeFormat('pt-BR', { timeZone: 'America/Sao_Paulo', day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }).format(date); })()}}\n\n---\n\n**IMPORTANTE**: Sua resposta deve conter APENAS a lista final formatada. Sem an√°lises, coment√°rios ou explica√ß√µes adicionais."}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[1792,608],"id":"7ad92dac-0107-442f-a4ef-66ca0227ffed","name":"tool_analista_criativos"},{"parameters":{"content":"## Extra√ß√£o M√©tricas Meta Ads","height":384,"width":800,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[32,560],"id":"8738ea5e-26b7-4d4c-84e3-17079389e90e","name":"Sticky Note"},{"parameters":{"content":"## Busca Melhores Criativos","height":384,"width":1120,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1376,560],"id":"94400b19-dd42-4383-88d8-b1beb6e8f007","name":"Sticky Note1"},{"parameters":{"content":"## Compara√ß√£o Per√≠odos","height":384,"width":480,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[864,560],"id":"8812b620-8dd4-41db-ac04-3f265a301b82","name":"Sticky Note2"},{"parameters":{"content":"","height":480,"width":992,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[736,48],"id":"a32d4648-0f01-495c-82cf-97bff4f824da","name":"Sticky Note3"},{"parameters":{"options":{"systemMessage":"=# Agente Orquestrador: Relat√≥rios de Tr√°fego Pago\n\n## IDENTIDADE E FUN√á√ÉO\nVoc√™ √© um orquestrador especializado em relat√≥rios de Meta Ads. Sua fun√ß√£o √© processar solicita√ß√µes de usu√°rios, executar ferramentas em sequ√™ncia l√≥gica e consolidar dados de performance de campanhas publicit√°rias.\n\n## OBJETIVO PRINCIPAL\nAutomatizar a gera√ß√£o de relat√≥rios de tr√°fego pago atrav√©s de:\n1. Compreens√£o precisa da solicita√ß√£o do usu√°rio\n2. Coleta de dados das contas publicit√°rias\n3. Processamento atrav√©s das ferramentas adequadas\n4. Formata√ß√£o final para envio via WhatsApp\n\n## PAR√ÇMETROS OBRIGAT√ìRIOS\n\n### Dados Necess√°rios (solicitar se ausentes):\n- **Tipo de Relat√≥rio**: Meta, Comparativo ou Completo\n- **Per√≠odo**: converter datas relativas para formato absoluto (start_date/end_date)\n- **Cliente**: nome para identifica√ß√£o e busca de IDs das contas\n- **Quantidade de Criativos**: n√∫mero desejado (padr√£o: 3)\n\n### Valida√ß√£o Inicial:\n**SEMPRE execute primeiro**: `base_dados_cliente(nome_cliente)`\n**Retorno esperado**: \n- `id_account_meta`\n- **Tipo de objetivo da campanha Meta** (Mensagens, Compras, Leads)\n- Configura√ß√µes espec√≠ficas do cliente\n\n## FLUXO DE EXECU√á√ÉO\n\n### ETAPA 1: COLETA DE REQUISITOS\n```\nSE dados incompletos:\n  ENT√ÉO solicitar informa√ß√µes faltantes\n  PARAR execu√ß√£o at√© receber dados completos\n```\n\n### ETAPA 2: VALIDA√á√ÉO DE CONTA\n```\nEXECUTAR: base_dados_cliente(cliente)\nVERIFICAR: retorno cont√©m IDs v√°lidos\nSE erro: informar cliente n√£o encontrado\n```\n\n### ETAPA 3: PROCESSAMENTO POR TIPO DE RELAT√ìRIO\n\n#### Relat√≥rio META\n```\nEXECUTAR: tool_analista_extrator_de_metricas_meta_ads (id_account_meta, start_date, end_date)\nPROCESSAR: dados baseados no objetivo da campanha identificado via base_dados_cliente\n\nOBJETIVOS SUPORTADOS:\n- MENSAGENS: Conversas + Custo por Conversa\n- COMPRAS: Compras + Custo por Compra + Checkout + ROAS\n- LEADS: Leads + Custo por Lead  \n- CHECKOUT: Inicia√ß√£o Checkout\n- M√öLTIPLO: Todas as m√©tricas quando objetivo n√£o espec√≠fico\n```\n\n#### Relat√≥rio COMPLETO\n```\nSEQU√äNCIA:\n1. tool_analista_extrator_de_metricas_meta_ads (id_account_meta, start_date, end_date)\n   - Processar baseado no objetivo espec√≠fico da campanha\n2. tool_analista_comparacao (per√≠odo_atual, per√≠odo_anterior)\n3. tool_analista_criativos (quantidade_especificada)\n```\n\n## TEMPLATES DE FORMATA√á√ÉO\n\n### Template An√°lise Comparativa:\n```\nüëâ *Per√≠odo Atual*\n\n*üìä Meta Ads - [Objetivo] - [Cliente]*\nüí∞ Investimento: R$ [valor]\n[M√©tricas espec√≠ficas baseadas no objetivo da campanha:]\n- MENSAGENS: üí¨ Conversas: [qty] | üíµ Custo por Conversa: R$ [valor]\n- COMPRAS: ü§ë Compras: [qty] | üëâ Valor de Compras: R$ [valor] | ‚úÖ ROAS: [valor]\n- LEADS: üìã Leads: [qty] | üíµ Custo por Lead: R$ [valor]\n- CHECKOUT: üõí Checkout: [qty] | üíµ Custo por Checkout: R$ [valor]\n\nüëâ *Per√≠odo Anterior*\n[Repetir estrutura acima com dados do per√≠odo anterior]\n```\n\n### Template Sa√≠da Final (WhatsApp):\n```\n*üìä √öltimos [X] Dias*\n\n*üìä Meta Ads - [Objetivo] - [Cliente]*\nüí∞ Investimento: R$ [valor]\n[M√©tricas baseadas no objetivo identificado:]\n- MENSAGENS: üí¨ Conversas: [qty] | üíµ Custo por Conversa: R$ [valor]\n- COMPRAS: ü§ë Compras: [qty] | üëâ Valor de Compras: R$ [valor] | ‚úÖ ROAS: [valor]\n- LEADS: üìã Leads: [qty] | üíµ Custo por Lead: R$ [valor]\n- CHECKOUT: üõí Checkout: [qty] | üíµ Custo por Checkout: R$ [valor]\n- M√öLTIPLO: Exibir todas as m√©tricas dispon√≠veis\n\n*Geral*\nüí∞ Investimento: R$ [total]\nü§ë Compras: [total]\nüëâ Valor de Compras: R$ [total]\n‚úÖ ROAS: [m√©dia_ponderada]\n\n*Top Criativos Meta*\n*Criativo #1*\n*Nome:* [nome]\n*Compras:* [quantidade]\n*Investimento:* R$ [valor]\n*Custo por Compra:* R$ [valor]\n*Link:* [url]\n\n*An√°lise Comparativa*\n[output da tool_analista_criativos]\n```\n\n## REGRAS DE OPERA√á√ÉO\n\n### CONVERS√ÉO DE DATAS\n- Converter sempre per√≠odos relativos (\"√∫ltimos 30 dias\") para datas absolutas\n- Formato: YYYY-MM-DD\n- Data de refer√™ncia: 19/07/2025 (hoje)\n\n### PAR√ÇMETROS DE FERRAMENTAS\n- Usar sempre campos expl√≠citos: `id_account`, `start_date`, `end_date`\n- Validar IDs antes de executar ferramentas\n- Tratar erros de API adequadamente\n\n### FORMATA√á√ÉO DE SA√çDA\n- **Nunca** usar dados fict√≠cios ou estimativas\n- Aplicar formata√ß√£o WhatsApp: *negrito* para t√≠tulos\n- Usar emojis conforme template\n- Valores monet√°rios em formato brasileiro (R$ X.XXX,XX)\n- ROAS com 2 casas decimais\n\n### TRATAMENTO DE ERROS\n```\nSE ferramenta falhar:\n  INFORMAR erro espec√≠fico ao usu√°rio\n  SUGERIR a√ß√£o corretiva\n  N√ÉO prosseguir com dados incompletos\n```\n\n## PROTOCOLO DE COMUNICA√á√ÉO\n\n### In√≠cio da Intera√ß√£o:\n1. Identificar dados fornecidos pelo usu√°rio\n2. Listar dados faltantes (se houver)\n3. Solicitar confirma√ß√£o antes de prosseguir\n\n### Durante Execu√ß√£o:\n1. Informar qual ferramenta est√° sendo executada\n2. Reportar conclus√£o de cada etapa\n3. Alertar sobre inconsist√™ncias nos dados\n\n### Entrega Final:\n1. Apresentar relat√≥rio formatado\n2. Destacar insights principais\n3. Oferecer esclarecimentos adicionais se necess√°rio\n\n---\n\n**LEMBRETE**: Sempre execute `base_dados_cliente` primeiro para obter os IDs das contas antes de qualquer outra ferramenta.\n\n- Hoje √© {{(() => {\n  const date = new Date(); // Pega o hor√°rio atual do servidor\n  return new Intl.DateTimeFormat('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  }).format(date);\n})()}}."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[1104,128],"id":"72f58d10-bdc4-4e3e-87d9-4a9fc1628445","name":"Arquiteto Relat√≥rios","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"documentId":{"__rl":true,"value":"1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms","mode":"list","cachedResultName":"[DADOS n8n] Panilha Clientes Tr√°fego ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1700272188,"mode":"list","cachedResultName":"Preencha - Base de Clientes","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms/edit#gid=1700272188"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[1248,336],"id":"51b2cdc3-3b0b-49ee-8094-7130a8344d19","name":"base_dados_cliente","retryOnFail":true,"credentials":{"googleSheetsOAuth2Api":{"id":"05sHmi34CnrxpGiZ","name":"Google Sheets account"}},"onError":"continueRegularOutput"},{"parameters":{"content":"## Agente Arquiteto Relat√≥rios Meta Ads","height":976,"width":2528,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"82b74cba-7336-4e53-839f-93f0d6b4d761","name":"Sticky Note4"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[80,800],"id":"68d3b21d-199f-42e6-8c18-53bf80a6a800","name":"GPT 4o1","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[928,800],"id":"04ec7a05-f9e9-40aa-b47e-e6b3c4640f51","name":"GPT 4o2","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1440,800],"id":"da120b13-c8f2-4f99-8c87-4c397c1763f4","name":"GPT 4o3","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}}],"connections":{"Simple Memory":{"ai_memory":[[{"node":"Arquiteto Relat√≥rios","type":"ai_memory","index":0}]]},"Think":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Arquiteto Relat√≥rios","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Arquiteto Relat√≥rios","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"Metricas_periodo_metaads":{"ai_tool":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_tool","index":0}]]},"Metricas_periodo_metaads_pelo_nome_campanha":{"ai_tool":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_tool","index":0}]]},"Simple Memory1":{"ai_memory":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_memory","index":0}]]},"Calculator1":{"ai_tool":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_tool","index":0}]]},"Simple Memory2":{"ai_memory":[[{"node":"tool_analista_comparacao","type":"ai_memory","index":0}]]},"Metricas_criativos_periodo_metaads":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"pega_ad_creative":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"metrics_by_name_ad":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"Pega _URL_anuncio":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"Simple Memory3":{"ai_memory":[[{"node":"tool_analista_criativos","type":"ai_memory","index":0}]]},"Calculator3":{"ai_tool":[[{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"Calculator2":{"ai_tool":[[{"node":"tool_analista_comparacao","type":"ai_tool","index":0}]]},"tool_analista_extrator_de _m√©tricas_meta_ads":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"tool_analista_criativos":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"tool_analista_comparacao":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0}]]},"base_dados_cliente":{"ai_tool":[[{"node":"Arquiteto Relat√≥rios","type":"ai_tool","index":0},{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_tool","index":0},{"node":"tool_analista_criativos","type":"ai_tool","index":0}]]},"GPT 4o":{"ai_languageModel":[[{"node":"Arquiteto Relat√≥rios","type":"ai_languageModel","index":0}]]},"GPT 4o3":{"ai_languageModel":[[{"node":"tool_analista_criativos","type":"ai_languageModel","index":0}]]},"GPT 4o2":{"ai_languageModel":[[{"node":"tool_analista_comparacao","type":"ai_languageModel","index":0}]]},"GPT 4o1":{"ai_languageModel":[[{"node":"tool_analista_extrator_de _m√©tricas_meta_ads","type":"ai_languageModel","index":0}]]}},"authors":"system migration","name":null,"description":null,"autosaved":false},"tags":[]}