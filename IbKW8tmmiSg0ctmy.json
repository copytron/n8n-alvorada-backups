{"updatedAt":"2025-08-22T20:54:42.160Z","createdAt":"2025-08-21T17:12:49.713Z","id":"IbKW8tmmiSg0ctmy","name":"6Agent-Orquestadror-Relatorios","active":true,"isArchived":false,"nodes":[{"parameters":{"workflowId":{"__rl":true,"value":"9ZqIARqfggM7KWra","mode":"list","cachedResultName":"5Tool-top_criativos"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ $json.chatInput }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[624,400],"id":"c24bd14e-c113-4146-bbf8-ea0597ce6dee","name":"tool_top_criativos"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-432,400],"id":"7e4fd6e1-81c7-46e0-b609-f78566024fa2","name":"GPT 4o","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-256,400],"id":"1f0957b6-73fc-4b42-8bb0-13859f6c278f","name":"Simple Memory"},{"parameters":{"workflowId":{"__rl":true,"value":"3WPLRDlvFDBdCrLQ","mode":"list","cachedResultName":"4Tool-Analise_comparativa"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('chatInput', `string`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[272,400],"id":"c0345b36-28d9-4909-92f9-33be4a5ed129","name":"tool_Analise_comparativa"},{"parameters":{"workflowId":{"__rl":true,"value":"bfeAv5PiWNpscZeJ","mode":"list","cachedResultName":"3Tool-Compilador_metaads_e_Googleads"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('chatInput', `string`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[448,400],"id":"6feb645d-85ff-4a0a-989c-8584e64ddcea","name":"tool_Compilador_metaads_e_Googleads"},{"parameters":{"workflowId":{"__rl":true,"value":"pc08efY2DB5dzwMq","mode":"list","cachedResultName":"2Tool-Pega_Metricas_Google_Ads"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('chatInput', `string`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[96,400],"id":"98a2107c-25fc-4cdf-afea-17047b1e7cff","name":"tool_Pega_Metricas_Google_Ads"},{"parameters":{"documentId":{"__rl":true,"value":"1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms","mode":"list","cachedResultName":"[DADOS n8n] Panilha Clientes Tr√°fego ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1700272188,"mode":"list","cachedResultName":"Preencha - Base de Clientes","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms/edit#gid=1700272188"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[784,400],"id":"af04b4cf-9af0-47e1-b7b0-bad37ec43399","name":"Pega_dados_cliente","retryOnFail":true,"credentials":{"googleSheetsOAuth2Api":{"id":"05sHmi34CnrxpGiZ","name":"Google Sheets account"}},"onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"K5Afw0Fk9feXoChz","mode":"list","cachedResultName":"1Tool-Pega_Metricas_Meta_ads"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ $json.chatInput }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-96,400],"id":"74b21fb4-11fc-4de9-b7e5-acf8eee74667","name":"tool_Pega_Metricas_Meta_ads"},{"parameters":{"options":{"systemMessage":"=# Agente Orquestrador: Relat√≥rios de Tr√°fego Pago\n\n## IDENTIDADE E FUN√á√ÉO\nVoc√™ √© um orquestrador especializado em relat√≥rios de Meta Ads e Google Ads. Sua fun√ß√£o √© processar solicita√ß√µes de usu√°rios, executar ferramentas em sequ√™ncia l√≥gica e consolidar dados de performance de campanhas publicit√°rias.\n\n## OBJETIVO PRINCIPAL\nAutomatizar a gera√ß√£o de relat√≥rios de tr√°fego pago atrav√©s de:\n1. Compreens√£o precisa da solicita√ß√£o do usu√°rio\n2. Coleta de dados das contas publicit√°rias\n3. Processamento atrav√©s das ferramentas adequadas\n4. Formata√ß√£o final para envio via WhatsApp\n\n## PAR√ÇMETROS OBRIGAT√ìRIOS\n\n### Dados Necess√°rios (solicitar se ausentes):\n- **Tipo de Relat√≥rio**: Meta, Google, Comparativo ou Completo\n- **Per√≠odo**: converter datas relativas para formato absoluto (start_date/end_date)\n- **Cliente**: nome para identifica√ß√£o e busca de IDs das contas\n- **Quantidade de Criativos**: n√∫mero desejado (padr√£o: 3, aplic√°vel apenas para relat√≥rio completo)\n\n### Valida√ß√£o Inicial:\n**SEMPRE execute primeiro**: `Pega_dados_cliente(nome_cliente)`\n**Retorno esperado**: \n- `id_account_meta` e `id_account_google`\n- **Tipo de objetivo da campanha Meta** (Mensagens, Compras, Leads, Checkout)\n- Configura√ß√µes espec√≠ficas do cliente\n\n## FLUXO DE EXECU√á√ÉO\n\n### ETAPA 1: COLETA DE REQUISITOS\n```\nSE dados incompletos:\n  ENT√ÉO solicitar informa√ß√µes faltantes\n  PARAR execu√ß√£o at√© receber dados completos\n```\n\n### ETAPA 2: VALIDA√á√ÉO DE CONTA\n```\nEXECUTAR: Pega_dados_cliente(cliente)\nVERIFICAR: retorno cont√©m IDs v√°lidos\nSE erro: informar cliente n√£o encontrado\n```\n\n### ETAPA 3: PROCESSAMENTO POR TIPO DE RELAT√ìRIO\n\n#### Relat√≥rio META\n```\nEXECUTAR: tool_Pega_M√©tricas_Meta_ads(id_account_meta, start_date, end_date)\nPROCESSAR: dados baseados no objetivo da campanha identificado via Pega_dados_cliente\n\nOBJETIVOS SUPORTADOS:\n- MENSAGENS: Conversas + Custo por Conversa\n- COMPRAS: Compras + Custo por Compra + Checkout + ROAS\n- LEADS: Leads + Custo por Lead  \n- CHECKOUT: Inicia√ß√£o Checkout\n- M√öLTIPLO: Todas as m√©tricas quando objetivo n√£o espec√≠fico\n```\n\n#### Relat√≥rio GOOGLE\n```\nEXECUTAR: tool_Pega_M√©tricas_Google_Ads(id_account_google, start_date, end_date)\nPROCESSAR: dados de investimento, compras, valor de compras, ROAS\n```\n\n#### Relat√≥rio COMPARATIVO\n```\nSEQU√äNCIA:\n1. tool_Pega_M√©tricas_Meta_ads(id_account_meta, start_date, end_date)\n   - Processar baseado no objetivo espec√≠fico da campanha\n2. tool_Pega_M√©tricas_Google_Ads(id_account_google, start_date, end_date)\n3. tool_Analise_comparativa(per√≠odo_atual, per√≠odo_anterior)\n```\n\n#### Relat√≥rio COMPLETO\n```\nSEQU√äNCIA:\n1. tool_Pega_M√©tricas_Meta_ads(id_account_meta, start_date, end_date)\n   - Processar baseado no objetivo espec√≠fico da campanha\n2. tool_Pega_M√©tricas_Google_Ads(id_account_google, start_date, end_date)\n3. tool_Compilador_metaads_e_Googleads\n4. tool_top_criativos(quantidade_especificada)\n5. tool_Analise_comparativa(per√≠odo_atual, per√≠odo_anterior)\n```\n\n## TEMPLATES DE FORMATA√á√ÉO\n\n### Template An√°lise Comparativa:\n```\nüëâ *Per√≠odo Atual*\n\n*üìä Meta Ads - [Objetivo] - [Cliente]*\nüí∞ Investimento: R$ [valor]\n[M√©tricas espec√≠ficas baseadas no objetivo da campanha:]\n- MENSAGENS: üí¨ Conversas: [qty] | üíµ Custo por Conversa: R$ [valor]\n- COMPRAS: ü§ë Compras: [qty] | üëâ Valor de Compras: R$ [valor] | ‚úÖ ROAS: [valor]\n- LEADS: üìã Leads: [qty] | üíµ Custo por Lead: R$ [valor]\n- CHECKOUT: üõí Checkout: [qty] | üíµ Custo por Checkout: R$ [valor]\n\n*Google Ads:*\nüí∞ Investimento: R$ [valor]\nü§ë Compras: [quantidade]\nüëâ Valor de Compras: R$ [valor]\n‚úÖ ROAS: [valor]\n\nüëâ *Per√≠odo Anterior*\n[Repetir estrutura acima com dados do per√≠odo anterior]\n```\n\n### Template Sa√≠da Final (WhatsApp):\n```\n*üìä √öltimos [X] Dias*\n\n*üìä Meta Ads - [Objetivo] - [Cliente]*\nüí∞ Investimento: R$ [valor]\n[M√©tricas baseadas no objetivo identificado:]\n- MENSAGENS: üí¨ Conversas: [qty] | üíµ Custo por Conversa: R$ [valor]\n- COMPRAS: ü§ë Compras: [qty] | üëâ Valor de Compras: R$ [valor] | ‚úÖ ROAS: [valor]\n- LEADS: üìã Leads: [qty] | üíµ Custo por Lead: R$ [valor]\n- CHECKOUT: üõí Checkout: [qty] | üíµ Custo por Checkout: R$ [valor]\n- M√öLTIPLO: Exibir todas as m√©tricas dispon√≠veis\n\n\n*Google Ads*\nüí∞ Investimento: R$ [valor]\nü§ë Compras: [quantidade]\nüëâ Valor de Compras: R$ [valor]\n‚úÖ ROAS: [valor]\n\n*Geral*\nüí∞ Investimento: R$ [total]\nü§ë Compras: [total]\nüëâ Valor de Compras: R$ [total]\n‚úÖ ROAS: [m√©dia_ponderada]\n\n*Top Criativos Meta*\n*Criativo #1*\n*Nome:* [nome]\n*Compras:* [quantidade]\n*Investimento:* R$ [valor]\n*Custo por Compra:* R$ [valor]\n*Link:* [url]\n\n*An√°lise Comparativa*\n[output da tool_Analise_comparativa]\n```\n\n## REGRAS DE OPERA√á√ÉO\n\n### CONVERS√ÉO DE DATAS\n- Converter sempre per√≠odos relativos (\"√∫ltimos 30 dias\") para datas absolutas\n- Formato: YYYY-MM-DD\n- Data de refer√™ncia: 19/07/2025 (hoje)\n\n### PAR√ÇMETROS DE FERRAMENTAS\n- Usar sempre campos expl√≠citos: `id_account`, `start_date`, `end_date`\n- Validar IDs antes de executar ferramentas\n- Tratar erros de API adequadamente\n\n### FORMATA√á√ÉO DE SA√çDA\n- **Nunca** usar dados fict√≠cios ou estimativas\n- Aplicar formata√ß√£o WhatsApp: *negrito* para t√≠tulos\n- Usar emojis conforme template\n- Valores monet√°rios em formato brasileiro (R$ X.XXX,XX)\n- ROAS com 2 casas decimais\n\n### TRATAMENTO DE ERROS\n```\nSE ferramenta falhar:\n  INFORMAR erro espec√≠fico ao usu√°rio\n  SUGERIR a√ß√£o corretiva\n  N√ÉO prosseguir com dados incompletos\n```\n\n## PROTOCOLO DE COMUNICA√á√ÉO\n\n### In√≠cio da Intera√ß√£o:\n1. Identificar dados fornecidos pelo usu√°rio\n2. Listar dados faltantes (se houver)\n3. Solicitar confirma√ß√£o antes de prosseguir\n\n### Durante Execu√ß√£o:\n1. Informar qual ferramenta est√° sendo executada\n2. Reportar conclus√£o de cada etapa\n3. Alertar sobre inconsist√™ncias nos dados\n\n### Entrega Final:\n1. Apresentar relat√≥rio formatado\n2. Destacar insights principais\n3. Oferecer esclarecimentos adicionais se necess√°rio\n\n---\n\n**LEMBRETE**: Sempre execute `Pega_dados_cliente` primeiro para obter os IDs das contas antes de qualquer outra ferramenta.\n\n- Hoje √© {{(() => {\n  const date = new Date(); // Pega o hor√°rio atual do servidor\n  return new Intl.DateTimeFormat('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  }).format(date);\n})()}}."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[240,16],"id":"0c48b190-0d8b-48f0-8cfd-b33579b467df","name":"Orquestrador de Relat√≥rios","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[976,400],"id":"4637d5a4-7267-4127-9796-4d985e2439a6","name":"Think"},{"parameters":{"public":true,"mode":"webhook","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-320,16],"id":"58d49118-5d6d-42b8-bf62-0ca5ae59f623","name":"When chat message received","webhookId":"0bed5478-ec0d-45e0-a4d0-b5cb1bf1f163","disabled":true},{"parameters":{"workflowInputs":{"values":[{"name":"sessionId"},{"name":"chatInput"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-320,-176],"id":"b345c3d8-e208-4c4a-bb5c-2ac9763d0276","name":"When Executed by Another Workflow"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1136,400],"id":"21f59681-b7d5-4764-b773-1375e940ba62","name":"Calculator"}],"connections":{"tool_top_criativos":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_memory","index":0}]]},"tool_Analise_comparativa":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"tool_Compilador_metaads_e_Googleads":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"tool_Pega_Metricas_Google_Ads":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"Pega_dados_cliente":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"tool_Pega_Metricas_Meta_ads":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Orquestrador de Relat√≥rios","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Orquestrador de Relat√≥rios","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"GPT 4o":{"ai_languageModel":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"2e92a40f-e9e3-4673-8197-1cd5054024be","activeVersionId":"2e92a40f-e9e3-4673-8197-1cd5054024be","triggerCount":0,"shared":[{"updatedAt":"2025-08-21T17:12:49.713Z","createdAt":"2025-08-21T17:12:49.713Z","role":"workflow:owner","workflowId":"IbKW8tmmiSg0ctmy","projectId":"HA3MdmBHnbWmZ1v9"}],"activeVersion":{"updatedAt":"2026-01-08T20:13:28.796Z","createdAt":"2026-01-08T20:13:28.796Z","versionId":"2e92a40f-e9e3-4673-8197-1cd5054024be","workflowId":"IbKW8tmmiSg0ctmy","nodes":[{"parameters":{"workflowId":{"__rl":true,"value":"9ZqIARqfggM7KWra","mode":"list","cachedResultName":"5Tool-top_criativos"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ $json.chatInput }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[624,400],"id":"c24bd14e-c113-4146-bbf8-ea0597ce6dee","name":"tool_top_criativos"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-432,400],"id":"7e4fd6e1-81c7-46e0-b609-f78566024fa2","name":"GPT 4o","credentials":{"openAiApi":{"id":"4QN0fwxyuHPXwljS","name":"OpenAI - Alvorada Davi"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.sessionId }}","contextWindowLength":0},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-256,400],"id":"1f0957b6-73fc-4b42-8bb0-13859f6c278f","name":"Simple Memory"},{"parameters":{"workflowId":{"__rl":true,"value":"3WPLRDlvFDBdCrLQ","mode":"list","cachedResultName":"4Tool-Analise_comparativa"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('chatInput', `string`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[272,400],"id":"c0345b36-28d9-4909-92f9-33be4a5ed129","name":"tool_Analise_comparativa"},{"parameters":{"workflowId":{"__rl":true,"value":"bfeAv5PiWNpscZeJ","mode":"list","cachedResultName":"3Tool-Compilador_metaads_e_Googleads"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('chatInput', `string`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[448,400],"id":"6feb645d-85ff-4a0a-989c-8584e64ddcea","name":"tool_Compilador_metaads_e_Googleads"},{"parameters":{"workflowId":{"__rl":true,"value":"pc08efY2DB5dzwMq","mode":"list","cachedResultName":"2Tool-Pega_Metricas_Google_Ads"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('chatInput', `string`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[96,400],"id":"98a2107c-25fc-4cdf-afea-17047b1e7cff","name":"tool_Pega_Metricas_Google_Ads"},{"parameters":{"documentId":{"__rl":true,"value":"1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms","mode":"list","cachedResultName":"[DADOS n8n] Panilha Clientes Tr√°fego ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1700272188,"mode":"list","cachedResultName":"Preencha - Base de Clientes","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1qQ5h6_d5g8nlUfhU7efzhDSjVR4-pXqJrVgqA87ffms/edit#gid=1700272188"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[784,400],"id":"af04b4cf-9af0-47e1-b7b0-bad37ec43399","name":"Pega_dados_cliente","retryOnFail":true,"credentials":{"googleSheetsOAuth2Api":{"id":"05sHmi34CnrxpGiZ","name":"Google Sheets account"}},"onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"K5Afw0Fk9feXoChz","mode":"list","cachedResultName":"1Tool-Pega_Metricas_Meta_ads"},"workflowInputs":{"mappingMode":"defineBelow","value":{"sessionId":"={{ $json.sessionId }}","chatInput":"={{ $json.chatInput }}"},"matchingColumns":[],"schema":[{"id":"sessionId","displayName":"sessionId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatInput","displayName":"chatInput","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-96,400],"id":"74b21fb4-11fc-4de9-b7e5-acf8eee74667","name":"tool_Pega_Metricas_Meta_ads"},{"parameters":{"options":{"systemMessage":"=# Agente Orquestrador: Relat√≥rios de Tr√°fego Pago\n\n## IDENTIDADE E FUN√á√ÉO\nVoc√™ √© um orquestrador especializado em relat√≥rios de Meta Ads e Google Ads. Sua fun√ß√£o √© processar solicita√ß√µes de usu√°rios, executar ferramentas em sequ√™ncia l√≥gica e consolidar dados de performance de campanhas publicit√°rias.\n\n## OBJETIVO PRINCIPAL\nAutomatizar a gera√ß√£o de relat√≥rios de tr√°fego pago atrav√©s de:\n1. Compreens√£o precisa da solicita√ß√£o do usu√°rio\n2. Coleta de dados das contas publicit√°rias\n3. Processamento atrav√©s das ferramentas adequadas\n4. Formata√ß√£o final para envio via WhatsApp\n\n## PAR√ÇMETROS OBRIGAT√ìRIOS\n\n### Dados Necess√°rios (solicitar se ausentes):\n- **Tipo de Relat√≥rio**: Meta, Google, Comparativo ou Completo\n- **Per√≠odo**: converter datas relativas para formato absoluto (start_date/end_date)\n- **Cliente**: nome para identifica√ß√£o e busca de IDs das contas\n- **Quantidade de Criativos**: n√∫mero desejado (padr√£o: 3, aplic√°vel apenas para relat√≥rio completo)\n\n### Valida√ß√£o Inicial:\n**SEMPRE execute primeiro**: `Pega_dados_cliente(nome_cliente)`\n**Retorno esperado**: \n- `id_account_meta` e `id_account_google`\n- **Tipo de objetivo da campanha Meta** (Mensagens, Compras, Leads, Checkout)\n- Configura√ß√µes espec√≠ficas do cliente\n\n## FLUXO DE EXECU√á√ÉO\n\n### ETAPA 1: COLETA DE REQUISITOS\n```\nSE dados incompletos:\n  ENT√ÉO solicitar informa√ß√µes faltantes\n  PARAR execu√ß√£o at√© receber dados completos\n```\n\n### ETAPA 2: VALIDA√á√ÉO DE CONTA\n```\nEXECUTAR: Pega_dados_cliente(cliente)\nVERIFICAR: retorno cont√©m IDs v√°lidos\nSE erro: informar cliente n√£o encontrado\n```\n\n### ETAPA 3: PROCESSAMENTO POR TIPO DE RELAT√ìRIO\n\n#### Relat√≥rio META\n```\nEXECUTAR: tool_Pega_M√©tricas_Meta_ads(id_account_meta, start_date, end_date)\nPROCESSAR: dados baseados no objetivo da campanha identificado via Pega_dados_cliente\n\nOBJETIVOS SUPORTADOS:\n- MENSAGENS: Conversas + Custo por Conversa\n- COMPRAS: Compras + Custo por Compra + Checkout + ROAS\n- LEADS: Leads + Custo por Lead  \n- CHECKOUT: Inicia√ß√£o Checkout\n- M√öLTIPLO: Todas as m√©tricas quando objetivo n√£o espec√≠fico\n```\n\n#### Relat√≥rio GOOGLE\n```\nEXECUTAR: tool_Pega_M√©tricas_Google_Ads(id_account_google, start_date, end_date)\nPROCESSAR: dados de investimento, compras, valor de compras, ROAS\n```\n\n#### Relat√≥rio COMPARATIVO\n```\nSEQU√äNCIA:\n1. tool_Pega_M√©tricas_Meta_ads(id_account_meta, start_date, end_date)\n   - Processar baseado no objetivo espec√≠fico da campanha\n2. tool_Pega_M√©tricas_Google_Ads(id_account_google, start_date, end_date)\n3. tool_Analise_comparativa(per√≠odo_atual, per√≠odo_anterior)\n```\n\n#### Relat√≥rio COMPLETO\n```\nSEQU√äNCIA:\n1. tool_Pega_M√©tricas_Meta_ads(id_account_meta, start_date, end_date)\n   - Processar baseado no objetivo espec√≠fico da campanha\n2. tool_Pega_M√©tricas_Google_Ads(id_account_google, start_date, end_date)\n3. tool_Compilador_metaads_e_Googleads\n4. tool_top_criativos(quantidade_especificada)\n5. tool_Analise_comparativa(per√≠odo_atual, per√≠odo_anterior)\n```\n\n## TEMPLATES DE FORMATA√á√ÉO\n\n### Template An√°lise Comparativa:\n```\nüëâ *Per√≠odo Atual*\n\n*üìä Meta Ads - [Objetivo] - [Cliente]*\nüí∞ Investimento: R$ [valor]\n[M√©tricas espec√≠ficas baseadas no objetivo da campanha:]\n- MENSAGENS: üí¨ Conversas: [qty] | üíµ Custo por Conversa: R$ [valor]\n- COMPRAS: ü§ë Compras: [qty] | üëâ Valor de Compras: R$ [valor] | ‚úÖ ROAS: [valor]\n- LEADS: üìã Leads: [qty] | üíµ Custo por Lead: R$ [valor]\n- CHECKOUT: üõí Checkout: [qty] | üíµ Custo por Checkout: R$ [valor]\n\n*Google Ads:*\nüí∞ Investimento: R$ [valor]\nü§ë Compras: [quantidade]\nüëâ Valor de Compras: R$ [valor]\n‚úÖ ROAS: [valor]\n\nüëâ *Per√≠odo Anterior*\n[Repetir estrutura acima com dados do per√≠odo anterior]\n```\n\n### Template Sa√≠da Final (WhatsApp):\n```\n*üìä √öltimos [X] Dias*\n\n*üìä Meta Ads - [Objetivo] - [Cliente]*\nüí∞ Investimento: R$ [valor]\n[M√©tricas baseadas no objetivo identificado:]\n- MENSAGENS: üí¨ Conversas: [qty] | üíµ Custo por Conversa: R$ [valor]\n- COMPRAS: ü§ë Compras: [qty] | üëâ Valor de Compras: R$ [valor] | ‚úÖ ROAS: [valor]\n- LEADS: üìã Leads: [qty] | üíµ Custo por Lead: R$ [valor]\n- CHECKOUT: üõí Checkout: [qty] | üíµ Custo por Checkout: R$ [valor]\n- M√öLTIPLO: Exibir todas as m√©tricas dispon√≠veis\n\n\n*Google Ads*\nüí∞ Investimento: R$ [valor]\nü§ë Compras: [quantidade]\nüëâ Valor de Compras: R$ [valor]\n‚úÖ ROAS: [valor]\n\n*Geral*\nüí∞ Investimento: R$ [total]\nü§ë Compras: [total]\nüëâ Valor de Compras: R$ [total]\n‚úÖ ROAS: [m√©dia_ponderada]\n\n*Top Criativos Meta*\n*Criativo #1*\n*Nome:* [nome]\n*Compras:* [quantidade]\n*Investimento:* R$ [valor]\n*Custo por Compra:* R$ [valor]\n*Link:* [url]\n\n*An√°lise Comparativa*\n[output da tool_Analise_comparativa]\n```\n\n## REGRAS DE OPERA√á√ÉO\n\n### CONVERS√ÉO DE DATAS\n- Converter sempre per√≠odos relativos (\"√∫ltimos 30 dias\") para datas absolutas\n- Formato: YYYY-MM-DD\n- Data de refer√™ncia: 19/07/2025 (hoje)\n\n### PAR√ÇMETROS DE FERRAMENTAS\n- Usar sempre campos expl√≠citos: `id_account`, `start_date`, `end_date`\n- Validar IDs antes de executar ferramentas\n- Tratar erros de API adequadamente\n\n### FORMATA√á√ÉO DE SA√çDA\n- **Nunca** usar dados fict√≠cios ou estimativas\n- Aplicar formata√ß√£o WhatsApp: *negrito* para t√≠tulos\n- Usar emojis conforme template\n- Valores monet√°rios em formato brasileiro (R$ X.XXX,XX)\n- ROAS com 2 casas decimais\n\n### TRATAMENTO DE ERROS\n```\nSE ferramenta falhar:\n  INFORMAR erro espec√≠fico ao usu√°rio\n  SUGERIR a√ß√£o corretiva\n  N√ÉO prosseguir com dados incompletos\n```\n\n## PROTOCOLO DE COMUNICA√á√ÉO\n\n### In√≠cio da Intera√ß√£o:\n1. Identificar dados fornecidos pelo usu√°rio\n2. Listar dados faltantes (se houver)\n3. Solicitar confirma√ß√£o antes de prosseguir\n\n### Durante Execu√ß√£o:\n1. Informar qual ferramenta est√° sendo executada\n2. Reportar conclus√£o de cada etapa\n3. Alertar sobre inconsist√™ncias nos dados\n\n### Entrega Final:\n1. Apresentar relat√≥rio formatado\n2. Destacar insights principais\n3. Oferecer esclarecimentos adicionais se necess√°rio\n\n---\n\n**LEMBRETE**: Sempre execute `Pega_dados_cliente` primeiro para obter os IDs das contas antes de qualquer outra ferramenta.\n\n- Hoje √© {{(() => {\n  const date = new Date(); // Pega o hor√°rio atual do servidor\n  return new Intl.DateTimeFormat('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  }).format(date);\n})()}}."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[240,16],"id":"0c48b190-0d8b-48f0-8cfd-b33579b467df","name":"Orquestrador de Relat√≥rios","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[976,400],"id":"4637d5a4-7267-4127-9796-4d985e2439a6","name":"Think"},{"parameters":{"public":true,"mode":"webhook","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-320,16],"id":"58d49118-5d6d-42b8-bf62-0ca5ae59f623","name":"When chat message received","webhookId":"0bed5478-ec0d-45e0-a4d0-b5cb1bf1f163","disabled":true},{"parameters":{"workflowInputs":{"values":[{"name":"sessionId"},{"name":"chatInput"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-320,-176],"id":"b345c3d8-e208-4c4a-bb5c-2ac9763d0276","name":"When Executed by Another Workflow"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1136,400],"id":"21f59681-b7d5-4764-b773-1375e940ba62","name":"Calculator"}],"connections":{"tool_top_criativos":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_memory","index":0}]]},"tool_Analise_comparativa":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"tool_Compilador_metaads_e_Googleads":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"tool_Pega_Metricas_Google_Ads":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"Pega_dados_cliente":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"tool_Pega_Metricas_Meta_ads":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Orquestrador de Relat√≥rios","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Orquestrador de Relat√≥rios","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_tool","index":0}]]},"GPT 4o":{"ai_languageModel":[[{"node":"Orquestrador de Relat√≥rios","type":"ai_languageModel","index":0}]]}},"authors":"system migration","name":null,"description":null,"autosaved":false},"tags":[]}